{% extends "base.html" %}

{% block title %}Discussion Forum - Study Forum{% endblock %}
{% block extra_head %} <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="../static/styles.css">
<script src="../static/studygroup.js" defer></script> {% endblock %}

{% block content %}
    {% if 'username' in session %}
    <div  style = 'text-align: center;'>
        <h2 class = 'sectionHeader'> Make a Study Group!</h2>
    </div>
    <div class= 'container'>
        <ul id="errorList"></ul>
    </div>
    <form action="{{url_for('study_groups')}}" method="POST" class="groupForm">
        {{ form.hidden_tag() }}
        <div>
            {{ form.unit_code.label }}
            {{ form.unit_code}}
            <br>
        </div>
        <div>
            {{ form.location.label }}
            {{ form.location}}
            <br>
        </div>
        <div>
            {{ form.dateof.label }}
            {{ form.dateof}}
            <br>
        </div>
        <div>
            {{ form.time.label }}
            {{ form.time}}
            <br>
        </div>
        <div>
            {{ form.description.label }}
            {{ form.description}}
            <br>
        </div>
        {{ form.submit(class="btn btn-primary", id="submitBtn") }}
    </form>
    <br>
    {% endif %}
    <div>
        <h2 class = 'sectionHeader'> Look for a Group!</h2>
    </div>

    <div id="study-groups" class="filter">
        <label for="filter_code">Enter Unit Code:</label>
        <input type="text" id="filter_code">
        <br>
        <label for="keywords">Enter Keywords:</label>
        <input type="text" id="keywords">
        <br>
        <button id="filterButton">Filter</button>
    </div>
    <p id = 'warning'> Study Group with Unit Code not Found!</p>
    
    <ul class="study_groups" id="study_groups">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="flash-message-error">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
        {% for group in allgroups %}
        <li class="group-item" data-unit-code='{{ group.unit_code }}' data-group-id='{{ group.group_id }}' data-description="{{group.description}}">
            <div class="group-details">
                <div class="group-info">
                    <span>{{ group.group_id }}</span>
                    <span>Location: {{ group.location }}</span>
                    <span>{{ group.unit_code }}</span>
                    <span>Date: {{ group.date }}</span>
                    <span>Time: {{ group.time }}</span>
                </div>
                <div class="group-description">
                    <p>Description: {{ group.description }}</p>
                    <p>Members:</p>
                    <ul style="align-items: center;">
                    {% for relation in group.user_relations %}
                        <li class="studentMembers">{{ relation.user.username }}</li>
                    {% endfor %}
                    </ul>
                    <a href="{{ url_for('joingroup', group_id=group.group_id) }}" class='btn btn-primary join-button'>Join Group</a>
                    <br>
                    <form action="{{ url_for('leavegroup', group_id=group.group_id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="leave-button">Leave Group</button>
                    </form>
                </div>
            </div>
        </li>
        {% endfor %}
    </ul>
{% endblock %}